$schema: "1.0"
name: "foundrylocal"
image: microsoftvisualstudio_visualstudioplustools_vs-2022-ent-general-win11-m365-gen2
description: "Installs Azure Foundry Local"

tasks:
  - name: ~/powershell
    description: Install Foundry Local
    parameters:
      command: |
          # Download the package and its dependency
          $releaseUri = "https://github.com/microsoft/Foundry-Local/releases/download/v0.3.9267/FoundryLocal-x64-0.3.9267.43123.msix"
          $localFoundryLocalPath = Join-Path -Path $env:TEMP -ChildPath FoundryLocal.msix
          Invoke-WebRequest -Method Get -Uri $releaseUri -OutFile $localFoundryLocalPath

          $vcLibsUri = "https://aka.ms/Microsoft.VCLibs.x64.14.00.Desktop.appx"
          $localvcLibsPath = Join-Path -Path $env:TEMP -ChildPath VcLibs.appx
          Invoke-WebRequest -Method Get -Uri $vcLibsUri -OutFile $localvcLibsPath

          # Install the Foundry Local package
          Add-AppxProvisionedPackage -Online -PackagePath $localFoundryLocalPath -DependencyPackagePath $localvcLibsPath -SkipLicense

  - name: ~/powershell
    description: Download a model
    parameters:
      command: foundry model download Phi-4-generic-cpu
